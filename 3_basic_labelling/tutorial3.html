<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="824.41">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;img src="images/tim50x50.png" align="left"&gt;In my last tutorial I briefly ran through using map tools to facilitate user interaction with the map canvas. Today we will take a brief look at labelling features.</p>
<p class="p2"><br></p>
<p class="p1">Before I carry on to far, note that QGIS's automatic labelling algorithm is very primative. Martin Dobias is planning to implement a much more useful label placement routine - but its not going to be available in QGIS 0.8. For the best label placement results you should defined fields in your attribute table for position, rotation etc of the label. Since this is only intended to be a 'get you started' introduction, I won't be doing all that here...</p>
<p class="p2"><br></p>
<p class="p1">&lt;p&gt;The entire project can be checked out form the QGIS Subversion repository using the following command:&lt;/p&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;pre&gt;svn co https://svn.qgis.org/repos/qgis/trunk/code_examples/3_basic_labelling</p>
<p class="p1">&lt;/pre&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;p&gt;In the working directory for the tutorial code you will find a number of files including c++ sources, icons and a simple data file under data. There is also the .ui file for the main window.&lt;/p&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; You will need to edit the .pro file in the above svn directory to match your system.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">&lt;h3&gt;Labelling Specifics&lt;/h3&gt;</p>
<p class="p2"><br></p>
<p class="p1">If you look in mainwindow.cpp you will notice a couple of new includes introduced since the last tutorial:</p>
<p class="p2"><br></p>
<p class="p1">&lt;code&gt;</p>
<p class="p1"><span class="Apple-converted-space">     </span>#include &lt;qgslabel.h&gt;</p>
<p class="p1"><span class="Apple-converted-space">     </span>#include &lt;qgslabelattributes.h&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>#include &lt;qgsfield.h&gt;</p>
<p class="p1">&lt;/code&gt;</p>
<p class="p2"><br></p>
<p class="p1">Each vector layer can have a QgsLabel associated with it. A QgsLabel is a renderer for labels. It has a member of type QgsLabelAttributes which determines the placement (above / below / left / right etc), rotation, size, size units (points or map units), font, colour and various other elements of the label. The QgsField include is needed because we will be querying the vector layer for its available fields so that we can determine which fiekd should be used for labelling.</p>
<p class="p2"><br></p>
<p class="p1">In the same cpp file you will see I define a label and a label attributes pointer. These will be used to setup the labelling characteristics we want and then assigned to the layer:</p>
<p class="p2"><br></p>
<p class="p1">&lt;code&gt;</p>
<p class="p1"><span class="Apple-converted-space">     </span>QgsLabel * mypLabel;</p>
<p class="p1"><span class="Apple-converted-space">     </span>QgsLabelAttributes * mypLabelAttributes;</p>
<p class="p1">&lt;/code&gt;</p>
<p class="p2"><br></p>
<p class="p1">Now we will see how we actually initialise and assign the QgsLabel and the QgsLabelAttributes to the vector layer.</p>
<p class="p2"><br></p>
<p class="p1">&lt;code&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>//</p>
<p class="p1"><span class="Apple-converted-space">    </span>//set up labelling for the layer</p>
<p class="p1"><span class="Apple-converted-space">    </span>//</p>
<p class="p1"><span class="Apple-converted-space">    </span>mypLabel = mypLayer-&gt;label();</p>
<p class="p1"><span class="Apple-converted-space">    </span>mypLabelAttributes = mypLabel-&gt;layerAttributes();</p>
<p class="p1">&lt;/code&gt;</p>
<p class="p2"><br></p>
<p class="p1">Great now we have a handle on the QgsLabel and QgsLabelAttributes we can start to manipulate how the label will be displayed. Note that the mypLabel-&gt;layerAttributes() method is poorly named and will likely be changed<span class="Apple-converted-space">  </span>before the final release of QGIS 1.0.</p>
<p class="p2"><br></p>
<p class="p1">Ok next lets ask the vector layer what attribute fields it has so that we can select one to be used for labelling:</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">&lt;code&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>std::vector&lt;QgsField&gt; myFields = mypLayer-&gt;fields();</p>
<p class="p1">&lt;/code&gt;</p>
<p class="p2"><br></p>
<p class="p1">By the way - you can browse the code for field, label, lable attributes etc from &lt;h href="https://svn.qgis.org/trac/browser/trunk/qgis/src/core"&gt;the QGIS source&lt;/a&gt;. Also for more implementation examples of how to set up labelling, its worth taking a look at &lt;a href="https://svn.qgis.org/trac/browser/trunk/qgis/src/gui/qgslabeldialog.cpp"&gt;qgslabeldialog.cpp&lt;/a&gt;.</p>
<p class="p2"><br></p>
<p class="p1">Now lets pick on of the fields from the field list and use it as the label field.</p>
<p class="p2"><br></p>
<p class="p1">&lt;code&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">   </span>mypLayer-&gt;setLabelOn(true);</p>
<p class="p1">&lt;/code&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;h3&gt;Mac Specific Notes&lt;/h3&gt;</p>
<p class="p2"><br></p>
<p class="p1">After building the application bundle (qmake; make) you can copy the spatial reference system database into the bundle to avoid 'cant find resource' type errors:</p>
<p class="p2"><br></p>
<p class="p1">&lt;code&gt;</p>
<p class="p1">mkdir -p qgis_example3.app/Contents/MacOS/share/qgis/resources/<span class="Apple-converted-space"> </span></p>
<p class="p1">cp -r /Applications/qgis.app/Contents/MacOS/share/qgis/resources/* \ qgis_example3.app/Contents/MacOS/share/qgis/resources/</p>
<p class="p1">&lt;/code&gt;</p>
</body>
</html>
